<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="lib/DPlayer.min.css">
    <script src="lib/flv.min.js"></script>
    <script src="lib/DPlayer.min.js"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            background-color: #000;
            margin: 0;
            padding: 0;
        }

        .dplayer-danmaku .dplayer-danmaku-right.dplayer-danmaku-move {
            font-size: 32px;
            will-change: transform;
            -webkit-animation: danmaku 10s linear;
            animation: danmaku 10s linear;
            -webkit-animation-play-state: paused;
            animation-play-state: paused
        }
    </style>
</head>
<body>
<div class="container" style="width:100%; height:100%; display: flex; justify-content: center;">
    <div id="dplayer" style="width: 100%;"></div>
</div>
<script>
    function get(url, callback) {
        const request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (request.readyState === 4 && request.status === 200) {
                callback(request.responseText);
            }
        };
        request.open("GET", url, true);
        request.send();
    }

    let url_string = window.location.href;
    let url = new URL(url_string);
    let aid = url.searchParams.get("aid") || 68836859;

    get(`repo/${aid}/info.json`, content => {
        let info = JSON.parse(content);
        document.title = info.data.title;
    });

    const dp = new DPlayer({
        container: document.getElementById('dplayer'),
        screenshot: false,
        video: {
            url: `repo/${aid}/video.flv`
        },
        hotkey: true,
        danmaku: {
            id: aid,
            api: ''
        },
        apiBackend: {
            read: function (options) {
                get(`repo/${aid}/danmaku.json`, content => {
                    options.success(JSON.parse(content).data);
                });
            },
            send: function (options) {
            }
        },
    });
    dp.danmaku.options.height = 50;
    dp.danmaku.options.speed = 10;
</script>
</body>
</html>
